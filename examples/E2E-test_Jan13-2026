Sample with gpt 5.2 on January 13th, 2026

--- Input ---

Problem/questions:

When I try to create an Agent in my project (with the GA version in an Azure AI Foundry project, not a hub-based project), I can only use model deployments deployed in my current Azure AI Foundry resource, despite having connected Azure OpenAI resources.


	1. When the OAI model is deployed on project level, the option to select a model is available when trying to create an agent from the studio. But the models deployed on the connected OpenAI resource does not show up. Is this a limitation?
	2. Even if we create the agent via SDK using a model deployment from the connected OpenAI resource, there is no option to select the deployments from the OpenAI resource. The only model available in the dropdown are the models deployed on the project level and not on the connect OAI resource level. 

Generally: "When using an Agent in my project, why can't I use it/see it with a model deployment in a connected Azure OpenAI resource?" 


Background:

https://learn.microsoft.com/en-us/azure/ai-foundry/agents/environment-setup?view=foundry-classic
https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic
https://learn.microsoft.com/en-us/azure/ai-foundry/what-is-azure-ai-foundry?view=foundry-classic#microsoft-foundry-portals 


Limitation:

Known issue with Agents seeing connected OpenAI resource deployments in the UI. Agents deployed by template also can't use connected resources unless their capability host is configured to see that resource. This applies to Foundry Classic UI. 

There is a known feature gap with Agents being able to see connected OpenAI resource model deployments. Specifically, Currently, we lack a UX for managing capability hosts. (Classic Foundry UI).
 
The project capability host is only configured by default with the project AI Services resource by default and in the templates we publish. It can be deleted/recreated to point to an Azure OpenAI resource instead of the AI Services resource so that all Agents in the project see the OpenAI resource deployments instead. 



Workaround: 

Create new capability host that points at an OpenAI resource instead of the AI Services resource using the aiServicesConnections property:
https://github.com/orgs/azure-ai-foundry/discussions/59

As of now there's no easy way to do this. However, this is a way.
	1. The connected OpenAI resource should be in the same region as the AIServices resource.
	2. You would need to create capability host. This could disrupt any existing agents under the AIServices resource.
How to create capability host?
Below is a python code - replace everywhere you see {something}.

import requests
import json
from azure.identity import DefaultAzureCredential
token = DefaultAzureCredential().get_token("https://management.azure.com/.default").token 
 
 
 ## Create account capability host
url = "https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/capabilityHosts/{any-cap-host-name}/"
querystring = {"api-version":"2025-04-01-preview"}
payload = {"properties": {"capabilityHostKind": "Agents"}}
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json",
    "User-Agent": "insomnia/11.0.1"
}
response = requests.request("PUT", url, json=payload, headers=headers, params=querystring)
print(response.text)
## Create project capability host
url = "https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/projects/{project-name}/capabilityHosts/{any-proj-cap-host-name}/"
querystring = {"api-version":"2025-04-01-preview"}
payload = {"properties": {
        "capabilityHostKind": "Agents",
        "aiServicesConnections": ["{connection-name-of-aoai-resource}"]
    }}
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json",
    "User-Agent": "insomnia/11.0.1"
}
response = requests.request("PUT", url, json=payload, headers=headers, params=querystring)
print(response.text)
The above would let you use Agents ONLY with the connected AOAI resource mentioned in the "aiServicesConnections" parameter. You could update or delete the capability host to be able to use deployments from other AOAI resource connection or from the parent AIServices resource.



NOTE: you cannot update a capability host, only delete and recreate. 

--- TSG output ---

[[_TOC_]]

Agents in Azure AI Foundry (Foundry classic) project can’t see/use model deployments from a connected Azure OpenAI resource (only project-level deployments appear)

# **Issue Description / Symptoms**
Customer is using the **GA version of Azure AI Foundry projects (non-hub-based)** in **Foundry classic** and tries to create an **Agent**.

- **What is the issue?**  
  In the Agent creation experience (and in the model dropdown after creating an agent), only **model deployments in the project’s current Azure AI Foundry / AI Services resource** are available. **Deployments from a connected Azure OpenAI (AOAI) resource do not appear**.
- **Who does this affect?**  
  Users creating/managing **Agents** in Foundry classic projects who expect to select deployments from **connected AOAI resources**.
- **Where does the issue occur? Where does it not occur?**  
  - Occurs in **Agents** model selection in **Foundry classic** project UI (and can still be true even if the agent is created via SDK referencing a connected AOAI deployment).  
  - Does not occur when the model deployment is **project-level** (deployed in the project’s own Foundry/AI Services resource), which does appear in the dropdown.
- **When does it occur?**  
  When the project has a connected AOAI resource, but the project’s **Capability Host** is not configured to use that connection for Agents.

# **When does the TSG not Apply**
- If the model deployment is created **within the project’s own Foundry/AI Services resource** (those deployments should appear in the Agent model dropdown).
- If the connected Azure OpenAI resource is **cross-subscription** relative to the project: **cross-subscription connections used for model deployment are not supported** for Foundry + Azure OpenAI connections.  
  https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/connections-add?view=foundry-classic
- If the customer is not using **Foundry classic** (this guidance is specific to the classic portal experience and its capability host management gap).  
  https://learn.microsoft.com/en-us/azure/ai-foundry/what-is-azure-ai-foundry?view=foundry-classic#microsoft-foundry-portals

# **Diagnosis**
- [ ] Confirm the customer is using **Foundry classic** and an **Azure AI Foundry project (GA, non-hub-based)**.
- [ ] Confirm the symptom: in **Agents** creation/configuration, the model dropdown only shows **project-level deployments** and not deployments from the **connected AOAI resource**.
- [ ] Validate connection constraints:
  - [ ] AOAI connection is **not cross-subscription** (unsupported for model deployment usage).  
    https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/connections-add?view=foundry-classic
  - [ ] AOAI resource is in the **same region** as the project’s AI Services resource (**constraint called out by the community workaround**, not an official documented requirement).  
    https://github.com/orgs/azure-ai-foundry/discussions/59
- [ ] Determine whether the project’s **Capability Host** is configured to use the AOAI connection via `aiServicesConnections`:
  - Capability hosts control what resources Agents can use; to use “your own model deployments” from AOAI, the capability host must include `aiServicesConnections`.  
    https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic
- [ ] If the customer attempted to create additional capability hosts and saw failures, check for the documented constraint:
  - Each account/project scope supports only one active capability host; creating another can result in **409 Conflict**.  
    https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic

{{MISSING::Diagnosis::Add internal Kusto/ASC/Acis steps or links if required by your support process}}

Don't Remove This Text: Results of the Diagnosis should be attached in the Case notes/ICM.

# **Questions to Ask the Customer**
1. Are you using **Foundry classic** portal for Agents?  
   https://learn.microsoft.com/en-us/azure/ai-foundry/what-is-azure-ai-foundry?view=foundry-classic#microsoft-foundry-portals
2. Is the connected Azure OpenAI resource in the **same subscription** as the project? (Cross-subscription connections for model deployment are not supported.)  
   https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/connections-add?view=foundry-classic
3. Is the connected Azure OpenAI resource in the **same region** as the project’s AI Services resource? (Constraint called out by the known workaround.)  
   https://github.com/orgs/azure-ai-foundry/discussions/59
4. Do you have existing Agents in the project that could be impacted if the capability host must be **deleted and recreated**?
5. What is the **connection name** of the AOAI resource in the project (needed for `aiServicesConnections`)?

# **Cause**
In Foundry classic, **Agents** only list and use model deployments from the resource(s) configured for the project’s **Capability Host**. By default, the project capability host is configured to use the project’s primary **AI Services/Foundry resource**, so only those deployments appear.

Connecting an Azure OpenAI resource to the project does **not** automatically make its deployments available to Agents unless the project capability host is configured with `aiServicesConnections` referencing that AOAI connection. Additionally, capability hosts **cannot be updated**; they must be **deleted and recreated** to change configuration.  
https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic

# **Mitigation or Resolution**
## Workaround: Create a project capability host that points to the connected AOAI resource (`aiServicesConnections`)
Per the community thread, there is currently no easy UX in Foundry classic for this; use the ARM management API approach described there.

Prerequisites / constraints:
- The connected AOAI resource should be in the **same region** as the AI Services resource (constraint called out by the community workaround).  
  https://github.com/orgs/azure-ai-foundry/discussions/59
- Capability hosts **can’t be updated**; to change the AOAI connection later, you must **delete and recreate** the capability host.  
  https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic
- Changing capability host configuration can **disrupt existing agents** (per community guidance).  
  https://github.com/orgs/azure-ai-foundry/discussions/59

### Step-by-step (Python example using ARM PUT)
Replace all `{...}` placeholders with customer-specific values.

> Note: The notes/research provide `api-version: 2025-04-01-preview` for these calls (from the workaround example). No official doc in the provided research confirms this exact API version; use as provided in the notes.

```python
import requests
import json
from azure.identity import DefaultAzureCredential

token = DefaultAzureCredential().get_token("https://management.azure.com/.default").token

## Create account capability host
url = "https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/capabilityHosts/{any-cap-host-name}/"
querystring = {"api-version":"2025-04-01-preview"}
payload = {"properties": {"capabilityHostKind": "Agents"}}
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json",
    "User-Agent": "insomnia/11.0.1"
}
response = requests.request("PUT", url, json=payload, headers=headers, params=querystring)
print(response.text)

## Create project capability host
url = "https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/projects/{project-name}/capabilityHosts/{any-proj-cap-host-name}/"
querystring = {"api-version":"2025-04-01-preview"}
payload = {"properties": {
        "capabilityHostKind": "Agents",
        "aiServicesConnections": ["{connection-name-of-aoai-resource}"]
    }}
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json",
    "User-Agent": "insomnia/11.0.1"
}
response = requests.request("PUT", url, json=payload, headers=headers, params=querystring)
print(response.text)
```

Expected outcome:
- After creating the project capability host with `aiServicesConnections`, Agents in the project should be able to use **deployments from the connected AOAI resource** specified in `aiServicesConnections`.
- Per the notes, this configuration makes Agents use **ONLY** the connected AOAI resource listed in `aiServicesConnections` (to use a different AOAI connection or revert to the parent AI Services resource, delete and recreate the capability host).

{{MISSING::Mitigation or Resolution::Document the exact delete/recreate steps for capability hosts (ARM/portal/CLI) if required, since updates are not supported}}

# **Root Cause to be shared with Customer**
Agents in Foundry classic only show model deployments from the resource(s) configured in the project’s **Capability Host**. By default, the capability host is set to the project’s AI Services/Foundry resource, so connected Azure OpenAI deployments won’t appear until the capability host is recreated to reference the AOAI connection (via `aiServicesConnections`). Capability host settings can’t be edited in place; they must be deleted and recreated.  
https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic

# **Related Information**
- Capability hosts (Foundry classic) — includes `aiServicesConnections` and notes that capability hosts can’t be updated (delete/recreate):  
  https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic
- Set up your environment (Foundry classic) — project scoping context for Agents:  
  https://learn.microsoft.com/en-us/azure/ai-foundry/agents/environment-setup?view=foundry-classic
- Add a new connection to your project — limitation: cross-subscription connections used for model deployment are not supported (Foundry + Azure OpenAI):  
  https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/connections-add?view=foundry-classic
- GitHub Discussion #59 — community workaround using capability hosts + `aiServicesConnections` and region constraint:  
  https://github.com/orgs/azure-ai-foundry/discussions/59
- Foundry portals (classic vs other portals) — context:  
  https://learn.microsoft.com/en-us/azure/ai-foundry/what-is-azure-ai-foundry?view=foundry-classic#microsoft-foundry-portals

# **Tags or Prompts**
- Tags: Azure AI Foundry, Foundry classic, Agents, Agent Service, capability host, aiServicesConnections, connected Azure OpenAI, AOAI, model deployments not showing, project capability host, delete and recreate, 409 Conflict
- Prompts:
  - “When using an Agent in my Azure AI Foundry project, why can’t I see model deployments from a connected Azure OpenAI resource?”
  - “How do I configure `aiServicesConnections` for Agents capability host in Foundry classic?”


--- Questions asked by model: --- 

- {{MISSING::Diagnosis::Add internal Kusto/ASC/Acis steps or links if required by your support process}} -> Do you want to include any internal-only diagnostics (Kusto queries/ASC actions/Acis commands) to confirm capability host configuration or agent/model selection behavior?
- {{MISSING::Mitigation or Resolution::Document the exact delete/recreate steps for capability hosts (ARM/portal/CLI) if required, since updates are not supported}} -> What are the approved/supportable steps (ARM/CLI/portal) to delete and recreate capability hosts, and should we include a specific script or command sequence?


--- Answers provided ---

No kusto queries exist for checking this

Delete Capability host: https://learn.microsoft.com/en-us/rest/api/aifoundry/accountmanagement/account-capability-hosts/delete?view=rest-aifoundry-accountmanagement-2025-06-01&tabs=HTTP



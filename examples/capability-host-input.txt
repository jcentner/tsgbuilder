Problem/questions:

When I try to create an Agent in my project (with the GA version in an Azure AI Foundry project, not a hub-based project), I can only use model deployments deployed in my current Azure AI Foundry resource, despite having connected Azure OpenAI resources.


	1. When the OAI model is deployed on project level, the option to select a model is available when trying to create an agent from the studio. But the models deployed on the connected OpenAI resource does not show up. Is this a limitation?
	2. Even if we create the agent via SDK using a model deployment from the connected OpenAI resource, there is no option to select the deployments from the OpenAI resource. The only model available in the dropdown are the models deployed on the project level and not on the connect OAI resource level. 

Generally: "When using an Agent in my project, why can't I use it/see it with a model deployment in a connected Azure OpenAI resource?" 


Background:

https://learn.microsoft.com/en-us/azure/ai-foundry/agents/environment-setup?view=foundry-classic
https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic
https://learn.microsoft.com/en-us/azure/ai-foundry/what-is-azure-ai-foundry?view=foundry-classic#microsoft-foundry-portals 


Limitation:

Known issue with Agents seeing connected OpenAI resource deployments in the UI. Agents deployed by template also can't use connected resources unless their capability host is configured to see that resource. This applies to Foundry Classic UI. 

There is a known feature gap with Agents being able to see connected OpenAI resource model deployments. Specifically, Currently, we lack a UX for managing capability hosts. (Classic Foundry UI).
 
The project capability host is only configured by default with the project AI Services resource by default and in the templates we publish. It can be deleted/recreated to point to an Azure OpenAI resource instead of the AI Services resource so that all Agents in the project see the OpenAI resource deployments instead. 



Workaround: 

Create new capability host that points at an OpenAI resource instead of the AI Services resource using the aiServicesConnections property:
https://github.com/orgs/azure-ai-foundry/discussions/59

As of now there's no easy way to do this. However, this is a way.
	1. The connected OpenAI resource should be in the same region as the AIServices resource.
	2. You would need to create capability host. This could disrupt any existing agents under the AIServices resource.
How to create capability host?
Below is a python code - replace everywhere you see {something}.

import requests
import json
from azure.identity import DefaultAzureCredential
token = DefaultAzureCredential().get_token("https://management.azure.com/.default").token 
 
 
 ## Create account capability host
url = "https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/capabilityHosts/{any-cap-host-name}/"
querystring = {"api-version":"2025-04-01-preview"}
payload = {"properties": {"capabilityHostKind": "Agents"}}
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json",
    "User-Agent": "insomnia/11.0.1"
}
response = requests.request("PUT", url, json=payload, headers=headers, params=querystring)
print(response.text)
## Create project capability host
url = "https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/projects/{project-name}/capabilityHosts/{any-proj-cap-host-name}/"
querystring = {"api-version":"2025-04-01-preview"}
payload = {"properties": {
        "capabilityHostKind": "Agents",
        "aiServicesConnections": ["{connection-name-of-aoai-resource}"]
    }}
headers = {
    "Authorization": f"Bearer {token}",
    "Content-Type": "application/json",
    "User-Agent": "insomnia/11.0.1"
}
response = requests.request("PUT", url, json=payload, headers=headers, params=querystring)
print(response.text)
The above would let you use Agents ONLY with the connected AOAI resource mentioned in the "aiServicesConnections" parameter. You could update or delete the capability host to be able to use deployments from other AOAI resource connection or from the parent AIServices resource.



NOTE: you cannot update a capability host, only delete and recreate. 
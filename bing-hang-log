data: {"type": "run_started", "data": {"run_id": "bd47f9a9-918b-4152-9626-8a70cffb7cab"}}

data: {"type": "stage_start", "data": {"message": "\ud83d\udd0d Research: Gathering documentation and references...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Model working...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing (mcp_list_tools)...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_search", "message": "\ud83d\udcda Calling microsoft_docs_search...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_search", "message": "\u2705 microsoft_docs_search complete (3.9s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_fetch", "message": "\ud83d\udcda Calling microsoft_docs_fetch...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_fetch", "message": "\u2705 microsoft_docs_fetch complete (4.0s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_fetch", "message": "\ud83d\udcda Calling microsoft_docs_fetch...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_fetch", "message": "\u2705 microsoft_docs_fetch complete (1.0s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "bing", "icon": "\ud83c\udf10", "name": "Bing Search", "message": "\ud83c\udf10 Bing Search", "status": "running", "stage": "research"}}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "error", "data": {"message": "The read operation timed out", "stage": "research"}}

data: {"type": "status", "data": {"message": "\u26a0\ufe0f Research: Tool call timed out, will retry...", "icon": "\u26a0\ufe0f", "stage": "research"}}

data: {"type": "status", "data": {"message": "\ud83d\udd04 Research: Retrying after timeout (attempt 2)...", "icon": "\ud83d\udd04", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Model working...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing (mcp_list_tools)...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_search", "message": "\ud83d\udcda Calling microsoft_docs_search...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_search", "message": "\u2705 microsoft_docs_search complete (4.0s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_fetch", "message": "\ud83d\udcda Calling microsoft_docs_fetch...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_fetch", "message": "\u2705 microsoft_docs_fetch complete (2.3s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_fetch", "message": "\ud83d\udcda Calling microsoft_docs_fetch...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_fetch", "message": "\u2705 microsoft_docs_fetch complete (1.4s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "bing", "icon": "\ud83c\udf10", "name": "Bing Search", "message": "\ud83c\udf10 Bing Search", "status": "running", "stage": "research"}}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "keepalive"}

data: {"type": "error", "data": {"message": "peer closed connection without sending complete message body (incomplete chunked read)", "stage": "research"}}

data: {"type": "status", "data": {"message": "\u26a0\ufe0f Research: Tool call timed out, will retry...", "icon": "\u26a0\ufe0f", "stage": "research"}}

data: {"type": "status", "data": {"message": "\ud83d\udd04 Research: Retrying after timeout (attempt 3)...", "icon": "\ud83d\udd04", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Model working...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing (mcp_list_tools)...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_search", "message": "\ud83d\udcda Calling microsoft_docs_search...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_search", "message": "\u2705 microsoft_docs_search complete (11.7s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\ud83d\udcda", "name": "microsoft_docs_fetch", "message": "\ud83d\udcda Calling microsoft_docs_fetch...", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "mcp", "icon": "\u2705", "name": "microsoft_docs_fetch", "message": "\u2705 microsoft_docs_fetch complete (1.0s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "tool", "data": {"type": "bing", "icon": "\ud83c\udf10", "name": "Bing Search", "message": "\ud83c\udf10 Bing Search", "status": "running", "stage": "research"}}

data: {"type": "tool", "data": {"type": "bing", "icon": "\u2705", "name": "Bing Search", "message": "\u2705 Bing Search complete (1.3s)", "status": "completed", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing search results...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Processing (bing_grounding_call_output)...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0d Research: Generating response...", "icon": "\ud83d\udd0d", "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (500 chars)", "chars": 500, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (1,001 chars)", "chars": 1001, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (1,502 chars)", "chars": 1502, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (2,005 chars)", "chars": 2005, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (2,504 chars)", "chars": 2504, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (3,002 chars)", "chars": 3002, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (3,518 chars)", "chars": 3518, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (4,014 chars)", "chars": 4014, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (4,504 chars)", "chars": 4504, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (5,001 chars)", "chars": 5001, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (5,503 chars)", "chars": 5503, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (6,002 chars)", "chars": 6002, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (6,504 chars)", "chars": 6504, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (7,008 chars)", "chars": 7008, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (7,508 chars)", "chars": 7508, "stage": "research"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0d Research: Writing response... (8,006 chars)", "chars": 8006, "stage": "research"}}

data: {"type": "status", "data": {"status": "completed", "message": "\u2705 Research: Complete", "icon": "\u2705", "stage": "research"}}

data: {"type": "stage_complete", "data": {"message": "\u2705 Research: Found documentation and references", "icon": "\u2705", "has_content": true, "stage": "research"}}

data: {"type": "stage_start", "data": {"message": "\u270f\ufe0f Write: Drafting TSG from notes and research...", "icon": "\u270f\ufe0f", "stage": "write"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\u270f\ufe0f Write: Processing...", "icon": "\u270f\ufe0f", "stage": "write"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\u270f\ufe0f Write: Model working...", "icon": "\u270f\ufe0f", "stage": "write"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\u270f\ufe0f Write: Generating response...", "icon": "\u270f\ufe0f", "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (501 chars)", "chars": 501, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (1,006 chars)", "chars": 1006, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (1,500 chars)", "chars": 1500, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (2,001 chars)", "chars": 2001, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (2,502 chars)", "chars": 2502, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (3,005 chars)", "chars": 3005, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (3,503 chars)", "chars": 3503, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (4,000 chars)", "chars": 4000, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (4,504 chars)", "chars": 4504, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (5,001 chars)", "chars": 5001, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (5,500 chars)", "chars": 5500, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (6,001 chars)", "chars": 6001, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (6,501 chars)", "chars": 6501, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (7,001 chars)", "chars": 7001, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (7,501 chars)", "chars": 7501, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (8,001 chars)", "chars": 8001, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (8,501 chars)", "chars": 8501, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (9,001 chars)", "chars": 9001, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (9,503 chars)", "chars": 9503, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (10,002 chars)", "chars": 10002, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (10,501 chars)", "chars": 10501, "stage": "write"}}

data: {"type": "progress", "data": {"message": "\u270f\ufe0f Write: Writing response... (11,001 chars)", "chars": 11001, "stage": "write"}}

data: {"type": "status", "data": {"status": "completed", "message": "\u2705 Write: Complete", "icon": "\u2705", "stage": "write"}}

data: {"type": "stage_complete", "data": {"message": "\u2705 Write: TSG draft complete", "icon": "\u2705", "stage": "write"}}

data: {"type": "stage_start", "data": {"message": "\ud83d\udd0e Review: Validating structure and accuracy...", "icon": "\ud83d\udd0e", "stage": "review"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0e Review: Processing...", "icon": "\ud83d\udd0e", "stage": "review"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0e Review: Model working...", "icon": "\ud83d\udd0e", "stage": "review"}}

data: {"type": "status", "data": {"status": "in_progress", "message": "\ud83d\udd0e Review: Generating response...", "icon": "\ud83d\udd0e", "stage": "review"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0e Review: Writing response... (500 chars)", "chars": 500, "stage": "review"}}

data: {"type": "progress", "data": {"message": "\ud83d\udd0e Review: Writing response... (1,000 chars)", "chars": 1000, "stage": "review"}}

data: {"type": "status", "data": {"status": "completed", "message": "\u2705 Review: Complete", "icon": "\u2705", "stage": "review"}}

data: {"type": "stage_complete", "data": {"message": "Review complete", "approved": true, "stage": "review"}}

data: {"type": "pipeline_complete", "data": {"success": true, "stages": ["research", "write", "review"], "retries": 0, "stage": "complete"}}

data: {"type": "result", "data": {"thread_id": "", "tsg": "[[_TOC_]]\n\n# **Title**\n**Azure AI Foundry (classic) Agents: Model deployments from connected Azure OpenAI resource do not appear / cannot be selected in Agent creation UI (project-based, non hub-based)**\n\n# **Issue Description / Symptoms**\nIn an **Azure AI Foundry (classic)** project (GA, **non hub-based**), when creating an **Agent** in the Studio:\n- Only **model deployments from the project\u2019s current/default Azure AI Foundry resource** appear in the model selection dropdown.\n- **Model deployments from a connected Azure OpenAI resource** do **not** appear in the dropdown.\n- Even if an Agent is created via SDK targeting a deployment from a connected Azure OpenAI resource, the Studio UI still only shows deployments from the project-level/default resource.\n\nCustomer questions captured in notes:\n1. If the model is deployed at project level, it is selectable; but deployments on the connected Azure OpenAI resource do not show up. Is this a limitation?\n2. If the agent is created via SDK using a connected Azure OpenAI deployment, why can\u2019t the UI select/show those deployments?\n\n# **When does the TSG not Apply**\n- If you are **not using Azure AI Foundry (classic)** Agents (this TSG is based on Foundry classic capability host behavior and documentation).\n- If the model deployment is already available at the **project level** (within the project\u2019s default model source), and it appears normally in the Agent model dropdown (this scenario is not the issue described here).\n- {{MISSING::When does the TSG not Apply::Confirm whether hub-based projects or private endpoint workspaces have different behavior/requirements for capability hosts and connected AOAI deployments}}\n\n# **Diagnosis**\nQuick checks:\n- Confirm the user is in **Azure AI Foundry (classic)** experience (docs referenced are `view=foundry-classic`).\n- Confirm the Azure OpenAI resource is added as a **connection** to the project, and note the **connection name**.\n- Check whether the project is using the default capability host configuration (typically aligned to the project\u2019s Azure AI Services resource) vs. a capability host configured with `aiServicesConnections` pointing to the connected Azure OpenAI resource.\n\nDeep dive (capability host configuration):\n- Agents\u2019 accessible model deployments are governed by the project\u2019s **capability host** configuration. The capability host can optionally specify `aiServicesConnections` to use \u201cyour own model deployments\u201d from **Azure OpenAI**.  \n  Reference: https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic\n- Capability hosts are hierarchical (service defaults \u2192 account \u2192 project), and **project overrides account**. Only **one capability host per scope** is allowed; attempting to create another at the same scope results in **409 Conflict**.  \n  Reference: https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic\n- Capability hosts **cannot be updated**; to change configuration you must **delete and recreate**.  \n  Reference: https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic\n\nInternal tooling:\n- {{MISSING::Diagnosis::Provide Kusto queries / ASC actions / internal commands to confirm current capability host configuration and which aiServicesConnections are set}}\n\nDon't Remove This Text: Results of the Diagnosis should be attached in the Case notes/ICM.\n\n# **Questions to Ask the Customer**\n- Are you using **Foundry classic** UI (links show `view=foundry-classic`) or a different/new Foundry experience?\n- What is the **connection name** of the connected Azure OpenAI resource in the project (the value intended for `aiServicesConnections`)?\n- Do you already have an **account-level** and/or **project-level** capability host configured? If yes, what are the current properties (especially `aiServicesConnections`)?\n- Are there existing Agents in the project that could be impacted if the capability host must be **deleted and recreated** (updates are not supported)?\n- Are the Azure AI Services resource and the connected Azure OpenAI resource in the **same region**? (This constraint is mentioned in the workaround discussion.)  \n  Reference: https://github.com/orgs/azure-ai-foundry/discussions/59\n\n# **Cause**\n- **Known feature gap / UX limitation in Foundry classic**: Agents do not have an easy UX to manage capability hosts, and by default the project capability host is configured to use the project\u2019s default Azure AI Services resource. As a result, **connected Azure OpenAI resource deployments do not appear** in the Agent model dropdown unless the project capability host is explicitly configured to use that Azure OpenAI connection via `aiServicesConnections`.  \n  References:\n  - Capability host mechanism and `aiServicesConnections`: https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic\n  - Community-confirmed symptom/workaround: https://github.com/orgs/azure-ai-foundry/discussions/59\n\n# **Mitigation or Resolution**\nWorkaround: Configure capability hosts so the **project capability host** points to the connected Azure OpenAI resource using `aiServicesConnections`.\n\nImportant constraints/notes from sources:\n- Capability hosts **cannot be updated**; you must **delete and recreate** to change configuration.  \n  Reference: https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic\n- Only **one capability host per scope** (account/project). Creating another at the same scope can return **409 Conflict**.  \n  Reference: https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic\n- The GitHub workaround notes the connected OpenAI resource should be in the **same region** as the AI Services resource, and that changing capability hosts may disrupt existing agents.  \n  Reference: https://github.com/orgs/azure-ai-foundry/discussions/59\n\nPython sample (from notes) to create capability hosts (replace `{...}` placeholders):\n> Note: The sample uses `api-version=2025-04-01-preview`. Verify the api-version against official documentation before use.\n\n```python\nimport requests\nimport json\nfrom azure.identity import DefaultAzureCredential\ntoken = DefaultAzureCredential().get_token(\"https://management.azure.com/.default\").token \n \n \n ## Create account capability host\nurl = \"https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/capabilityHosts/{any-cap-host-name}/\"\nquerystring = {\"api-version\":\"2025-04-01-preview\"}\npayload = {\"properties\": {\"capabilityHostKind\": \"Agents\"}}\nheaders = {\n    \"Authorization\": f\"Bearer {token}\",\n    \"Content-Type\": \"application/json\",\n    \"User-Agent\": \"insomnia/11.0.1\"\n}\nresponse = requests.request(\"PUT\", url, json=payload, headers=headers, params=querystring)\nprint(response.text)\n\n## Create project capability host\nurl = \"https://management.azure.com/subscriptions/{sub-id}/resourceGroups/{res-group-name}/providers/Microsoft.CognitiveServices/accounts/{ai-services-resource}/projects/{project-name}/capabilityHosts/{any-proj-cap-host-name}/\"\nquerystring = {\"api-version\":\"2025-04-01-preview\"}\npayload = {\"properties\": {\n        \"capabilityHostKind\": \"Agents\",\n        \"aiServicesConnections\": [\"{connection-name-of-aoai-resource}\"]\n    }}\nheaders = {\n    \"Authorization\": f\"Bearer {token}\",\n    \"Content-Type\": \"application/json\",\n    \"User-Agent\": \"insomnia/11.0.1\"\n}\nresponse = requests.request(\"PUT\", url, json=payload, headers=headers, params=querystring)\nprint(response.text)\n```\n\nExpected outcome:\n- After the project capability host is created with `aiServicesConnections` set to the **AOAI connection name**, Agents in the project can use deployments from that connected Azure OpenAI resource.\n- Per notes: this configuration allows Agents to use **ONLY** the connected AOAI resource specified in `aiServicesConnections`. To switch to another AOAI connection or back to the parent AI Services resource, you must **delete and recreate** the capability host.\n\nDeletion/recreate guidance:\n- {{MISSING::Mitigation or Resolution::Provide the supported REST/CLI steps (or internal runbook) to delete an existing capability host before recreating it, including how to handle 409 Conflict}}\n\n# **Root Cause to be shared with Customer**\nIn Azure AI Foundry (classic), the Agent model dropdown reflects the model deployments available to the project\u2019s **capability host**. By default, the project capability host is configured to use the project\u2019s default resource, and the classic UI currently lacks an easy way to manage capability hosts to include connected Azure OpenAI resources. Configuring the project capability host with `aiServicesConnections` pointing to the connected Azure OpenAI connection enables Agents to use those deployments (changes require delete/recreate because capability hosts can\u2019t be updated).\n\n# **Related Information**\n- Capability hosts (Foundry classic): https://learn.microsoft.com/en-us/azure/ai-foundry/agents/concepts/capability-hosts?view=foundry-classic\n- Agents environment setup (Foundry classic): https://learn.microsoft.com/en-us/azure/ai-foundry/agents/environment-setup?view=foundry-classic\n- GitHub Discussion (workaround and limitation): https://github.com/orgs/azure-ai-foundry/discussions/59\n- Bring your own Azure Storage (Foundry classic) \u2013 configure capability hosts for agents (capability host configuration pattern): https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/bring-your-own-azure-storage-foundry?view=foundry-classic#configure-capability-hosts-for-agents\n\n# **Tags or Prompts**\n- Tags: Azure AI Foundry, Foundry classic, Agents, capability host, capabilityHosts, aiServicesConnections, connected Azure OpenAI, AOAI, model deployments not showing, dropdown missing deployments, 409 Conflict, delete and recreate\n- This TSG helps answer: \u201cWhy can\u2019t I see or use model deployments from a connected Azure OpenAI resource when creating an Agent in Azure AI Foundry (classic)?\u201d", "questions": "- {{MISSING::When does the TSG not Apply::Confirm whether hub-based projects or private endpoint workspaces have different behavior/requirements for capability hosts and connected AOAI deployments}} -> Does this issue/workaround differ for hub-based projects and/or private endpoint-enabled workspaces, and should they be explicitly excluded?\n- {{MISSING::Diagnosis::Provide Kusto queries / ASC actions / internal commands to confirm current capability host configuration and which aiServicesConnections are set}} -> What internal queries/actions should CSS use to verify the current account/project capability host configuration and `aiServicesConnections`?\n- {{MISSING::Mitigation or Resolution::Provide the supported REST/CLI steps (or internal runbook) to delete an existing capability host before recreating it, including how to handle 409 Conflict}} -> What are the supported steps (REST/CLI/internal) to delete existing capability hosts and recreate them safely, and how should 409 conflicts be handled in practice?", "complete": false, "stages_completed": ["research", "write", "review"], "retries": 0, "warnings": ["Mitigation/Resolution includes a Python sample using api-version=2025-04-01-preview. Research notes indicate official docs use 2025-06-01 and 2025-04-01-preview is not confirmed. The draft appropriately flags this with a note to verify, so it is not a blocking accuracy issue, but it should be treated as non-authoritative until confirmed.", "Consider softening/qualifying the 'same region' statement as 'reported in GitHub discussion' (not in official docs), but current wording already attributes it to the GitHub source.", "If this TSG is intended for CSS, consider adding a brief warning to coordinate with customer before deleting capability hosts due to potential impact on existing agents (already mentioned, but could be elevated)."]}}

